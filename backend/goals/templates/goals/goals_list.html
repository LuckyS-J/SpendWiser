{% extends 'base.html' %}
{% block title %}Your Goals{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Your Goals</h2>

  <div class="mb-4 p-3 bg-secondary bg-opacity-25 rounded text-light">
    <p>Total goals: {{ goals|length }}</p>
    <p>Completed: {{ completed_count }}</p>
    <p>In progress: {{ in_progress_count }}</p>
  </div>

  <div class="mb-3 text-end">
    <a href="{% url 'goal-add' %}" class="btn btn-primary">Add New Goal</a>
  </div>

  {% if goals %}
  {% for goal in goals %}
  <div class="card shadow-sm mb-3" style="background-color: #0d1117; border-radius: 12px;">
    <div class="card-body text-light">
      <div class="row align-items-center">

        <!-- Left column: Name and created date -->
        <div class="col-md-4 mb-3 mb-md-0">
          <h5>{{ goal.name }}</h5>
          <small>Created: {{ goal.created_at }}</small><br>
          <small>Status:
            {% if goal.is_completed %}
            <span class="text-success fw-bold">Completed</span>
            {% else %}
            <span class="text-warning fw-bold">In Progress</span>
            {% endif %}
          </small>
        </div>

        <!-- Middle column: Target and current -->
        <div class="col-md-3 mb-3 mb-md-0">
          <small>Target: {{ goal.target }} PLN</small><br>
          <small>Current: {{ goal.current }} PLN</small>
        </div>

        <!-- Right column: Progress bar and buttons -->
        <div class="col-md-5">
          <div class="progress mb-3" style="height: 20px;">
            <div class="progress-bar progress-bar-goal" role="progressbar" style="width: {{ goal.progress_percent }}%;"
              aria-valuenow="{{ goal.current }}" aria-valuemin="0" aria-valuemax="{{ goal.target }}">
            </div>
          </div>
          <div class="d-flex gap-2 flex-wrap">
            <a href="{% url 'goal-add-progress' goal.id %}" class="btn btn-sm btn-primary flex-grow-1">Add Progress</a>
            <form method="post" style="flex-grow: 1;" action="{% url 'goal-delete' goal.id %}">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-danger w-100"
                onclick="return confirm('Are you sure you want to delete this goal?');">Delete</button>
            </form>
          </div>
        </div>

      </div>
    </div>
  </div>
  {% endfor %}
  {% else %}
  <p class="text-center mt-4">
    You don't have any goals yet!
  </p>
  {% endif %}
</div>
{% endblock %}